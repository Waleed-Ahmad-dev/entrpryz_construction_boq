<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- All rules should use consistent field access patterns -->
        <!-- Rule for main BOQ model -->
        <record id="rule_construction_boq_multi_company" model="ir.rule">
            <field name="name">Construction BOQ Multi-Company</field>
            <field name="model_id" ref="model_construction_boq"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>

        <!-- Rule for BOQ Line model -->
        <record id="rule_construction_boq_line_multi_company" model="ir.rule">
            <field name="name">Construction BOQ Line Multi-Company</field>
            <field name="model_id" ref="model_construction_boq_line"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>

        <!-- Rule for BOQ Consumption model - Optimized to store company_id directly -->
        <record id="rule_construction_boq_consumption_multi_company" model="ir.rule">
            <field name="name">Construction BOQ Consumption Multi-Company</field>
            <field name="model_id" ref="model_construction_boq_consumption"/>
            <field name="global" eval="True"/>
            <!-- 
            IMPORTANT: For optimal performance, ensure construction_boq_consumption
            model has a company_id field (computed or related) to avoid join queries.
            If not, consider adding: 
            company_id = fields.Many2one('res.company', related='boq_line_id.company_id', store=True)
            -->
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>

        <!-- Rule for BOQ Report model -->
        <record id="rule_construction_boq_report_multi_company" model="ir.rule">
            <field name="name">Construction BOQ Report Multi-Company</field>
            <field name="model_id" ref="model_construction_boq_report"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>
    </data>
</odoo>